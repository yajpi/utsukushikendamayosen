<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>けん玉 予選練習（各技2回・3アウト）</title>
<style>
:root{
  --bg:#0b0f14;
  --text:#e7eef7;
  --muted:#a9b6c7;
  --good:#3ddc97;
  --warn:#ffcc66;
  --bad:#ff2d2d;
  --line:#263244;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,"Hiragino Sans","Noto Sans JP",sans-serif;
  background:linear-gradient(180deg,#0b0f14,#111a24);
  color:var(--text);
}
.wrap{max-width:960px;margin:0 auto;padding:18px}
.card{
  background:#111a24;
  border:1px solid var(--line);
  border-radius:18px;
  padding:16px;
  margin-bottom:16px;
}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
.badge{
  background:#0e1620;
  border:1px solid var(--line);
  border-radius:999px;
  padding:6px 10px;
  font-size:12px;
  color:var(--muted);
}
.badge strong{color:#fff;font-weight:800}

.techBig{font-size:28px;font-weight:900;margin:8px 0}

.attemptMarks{display:flex;gap:8px;margin-bottom:8px}
.mark{
  width:18px;height:18px;border-radius:999px;
  border:2px solid rgba(255,255,255,.2);
  background:#222;
  transition:.2s;
}
.mark.ok{background:var(--good);box-shadow:0 0 10px var(--good)}
.mark.ng{background:var(--warn);box-shadow:0 0 10px var(--warn)}

.outsDots{display:flex;gap:10px;margin-top:6px}
.outsDots .dot{
  width:20px;height:20px;border-radius:999px;
  border:2px solid rgba(255,255,255,.2);
  background:#222;
}
.outsDots .dot.on{
  background:var(--bad);
  box-shadow:0 0 12px var(--bad);
}

.btns{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
button{
  border:none;border-radius:16px;
  padding:16px;font-size:18px;font-weight:900;
  cursor:pointer;color:#fff;
  transition:.15s;
  position:relative;overflow:hidden;
}
button.ok{background:#1f3d32}
button.ng{background:#3d1f2b}
button:active{transform:scale(.97)}

button.flash.ok{animation:okPulse .35s}
button.flash.ng{animation:ngShake .4s}

@keyframes okPulse{
  0%{transform:scale(1)}
  40%{transform:scale(1.05)}
  100%{transform:scale(1)}
}
@keyframes ngShake{
  0%{transform:translateX(0)}
  25%{transform:translateX(-6px)}
  50%{transform:translateX(6px)}
  75%{transform:translateX(-4px)}
  100%{transform:translateX(0)}
}

.overlay{
  position:fixed;inset:0;
  display:none;align-items:center;justify-content:center;
  background:rgba(0,0,0,.7);
}
.overlay.show{display:flex}
.endCard{
  background:#111a24;
  border:1px solid var(--line);
  border-radius:20px;
  padding:24px;
  max-width:520px;width:100%;
  text-align:center;
}
.endTitle{font-size:36px;font-weight:900;margin-bottom:12px}
.endBox{margin:6px 0;font-size:16px}
</style>
</head>
<body>
<div class="wrap">

<div class="card">
<div class="row">
<div class="badge">技番号：<strong id="techNo">1</strong> / 20</div>
<div class="badge">試行：<strong id="attemptNo">1</strong> / 2</div>
</div>

<div class="techBig" id="techName">小皿</div>

<div class="attemptMarks">
<div class="mark" id="mark1"></div>
<div class="mark" id="mark2"></div>
</div>

<div class="outsDots">
<div class="dot" id="outDot1"></div>
<div class="dot" id="outDot2"></div>
<div class="dot" id="outDot3"></div>
</div>
<div class="badge">アウト：<strong id="outs">0</strong> / 3</div>

<div class="btns">
<button class="ok" id="btnOk">成功</button>
<button class="ng" id="btnNg">失敗</button>
</div>
</div>

<div class="card">
<div class="badge">技リスト（予選20種目）</div>
<ol id="techList"></ol>
</div>

</div>

<div class="overlay" id="overlay">
<div class="endCard">
<div class="endTitle">FINISHED</div>
<div class="endBox" id="endReason"></div>
<div class="endBox" id="endReach"></div>
<div class="endBox" id="endClass"></div>
</div>
</div>

<script>
const TECHS=[
"小皿","ろうそく","とめけん","飛行機","ふりけん",
"県一周","日本一周","世界一周","灯台","うぐいす",
"つるしとめけん","地球まわし","宇宙一周","さか落とし","はねけん",
"一回転灯台","一回転飛行機","すべり止め極意","灯台とんぼ返り","うらふりけん"
];

let index=0;
let attempt=1;
let outs=0;
let finished=false;
let attemptResults=[];

const $=id=>document.getElementById(id);
const btnOk=$("btnOk");
const btnNg=$("btnNg");
const mark1=$("mark1");
const mark2=$("mark2");

function renderList(){
const list=$("techList");
TECHS.forEach(t=>{
const li=document.createElement("li");
li.textContent=t;
list.appendChild(li);
});
}

function updateUI(){
$("techNo").textContent=index+1;
$("techName").textContent=TECHS[index]||"終了";
$("attemptNo").textContent=attempt;
$("outs").textContent=outs;
$("outDot1").classList.toggle("on",outs>=1);
$("outDot2").classList.toggle("on",outs>=2);
$("outDot3").classList.toggle("on",outs>=3);
}

function resetMarks(){
mark1.className="mark";
mark2.className="mark";
}

function updateMarks(){
resetMarks();
if(attemptResults[0]==="OK")mark1.classList.add("ok");
if(attemptResults[0]==="NG")mark1.classList.add("ng");
if(attemptResults[1]==="OK")mark2.classList.add("ok");
if(attemptResults[1]==="NG")mark2.classList.add("ng");
}

function classify(n){
if(n<=4)return"チャレンジクラス";
if(n<=8)return"Cクラス";
if(n<=13)return"Bクラス";
if(n<=17)return"Aクラス";
return"0〜1クラス";
}

function finish(reason){
finished=true;
$("overlay").classList.add("show");
$("endReason").textContent=reason;
$("endReach").textContent="到達：技 "+(index+1);
$("endClass").textContent="クラス判定："+classify(index+1);
}

function nextTech(){
index++;
attempt=1;
attemptResults=[];
resetMarks();
if(index>=TECHS.length){
finish("20種目完走");
}
}

function logTap(result){
if(finished)return;

attemptResults.push(result);
updateMarks();

if(result==="OK"){
btnOk.classList.add("flash");
setTimeout(()=>btnOk.classList.remove("flash"),400);
}else{
btnNg.classList.add("flash");
setTimeout(()=>btnNg.classList.remove("flash"),400);
}

if(attempt===1){
attempt=2;
updateUI();
return;
}

if(attemptResults[0]==="NG"&&attemptResults[1]==="NG"){
outs++;
}

updateUI();

btnOk.disabled=true;
btnNg.disabled=true;

setTimeout(()=>{
if(outs>=3){
finish("アウト3回に到達");
}else{
nextTech();
updateUI();
}
btnOk.disabled=false;
btnNg.disabled=false;
},800);
}

btnOk.onclick=()=>logTap("OK");
btnNg.onclick=()=>logTap("NG");

renderList();
updateUI();
</script>
</body>
</html>